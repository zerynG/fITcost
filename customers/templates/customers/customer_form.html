{% extends 'base_form.html' %}

{% block title %}{% if form.instance.pk %}Редактировать{% else %}Создать{% endif %} Заказчика{% endblock %}

{% block form_title %}{% if form.instance.pk %}Редактирование заказчика{% else %}Создание заказчика{% endif %}{% endblock %}

{% block form_fields %}
    {{ form.project }}
    
    <div class="row mb-3">
        <div class="col-md-6">
            <label for="{{ form.inn.id_for_label }}" class="form-label">{{ form.inn.label }}</label>
            {{ form.inn }}
            {% if form.inn.errors %}
                <div class="invalid-feedback d-block">{{ form.inn.errors }}</div>
            {% endif %}
        </div>
        <div class="col-md-6">
            <label for="{{ form.customer_type.id_for_label }}" class="form-label">{{ form.customer_type.label }}</label>
            {{ form.customer_type }}
            {% if form.customer_type.errors %}
                <div class="invalid-feedback d-block">{{ form.customer_type.errors }}</div>
            {% endif %}
        </div>
    </div>
    
    <div class="row mb-3">
        <div class="col-md-6">
            <label for="{{ form.name.id_for_label }}" class="form-label">{{ form.name.label }}</label>
            {{ form.name }}
            {% if form.name.errors %}
                <div class="invalid-feedback d-block">{{ form.name.errors }}</div>
            {% endif %}
        </div>
        <div class="col-md-6">
            <label for="{{ form.full_name.id_for_label }}" class="form-label">{{ form.full_name.label }}</label>
            {{ form.full_name }}
            {% if form.full_name.errors %}
                <div class="invalid-feedback d-block">{{ form.full_name.errors }}</div>
            {% endif %}
        </div>
    </div>
    
    <div class="row mb-3">
        <div class="col-md-6">
            <label for="{{ form.email.id_for_label }}" class="form-label">{{ form.email.label }}</label>
            {{ form.email }}
            {% if form.email.errors %}
                <div class="invalid-feedback d-block">{{ form.email.errors }}</div>
            {% endif %}
        </div>
        <div class="col-md-6">
            <label for="{{ form.phone.id_for_label }}" class="form-label">{{ form.phone.label }}</label>
            {{ form.phone }}
            {% if form.phone.errors %}
                <div class="invalid-feedback d-block">{{ form.phone.errors }}</div>
            {% endif %}
        </div>
    </div>
    
    <div class="form-check mb-3">
        {{ form.can_be_shared }}
        <label class="form-check-label" for="{{ form.can_be_shared.id_for_label }}">
            {{ form.can_be_shared.label }}
        </label>
        {% if form.can_be_shared.errors %}
            <div class="invalid-feedback d-block">{{ form.can_be_shared.errors }}</div>
        {% endif %}
    </div>
{% endblock %}

{% block cancel_url %}
    {% if project_id and workspace_id %}
        {% url 'customers:customer_list_project' workspace_id project_id %}
    {% else %}
        {% url 'customers:customer_list' %}
    {% endif %}
{% endblock %}

{% block extra_js %}
<script>
function toggleCompanyName() {
    const customerType = document.getElementById('id_customer_type').value;
    const companyNameField = document.getElementById('company-name-field');
    const companyNameLabel = document.querySelector('label[for="id_name"]');
    
    if (customerType === 'individual') {
        companyNameField.style.display = 'none';
        if (companyNameLabel) companyNameLabel.style.display = 'none';
        companyNameField.required = false;
    } else {
        companyNameField.style.display = 'block';
        if (companyNameLabel) companyNameLabel.style.display = 'block';
        companyNameField.required = true;
    }
}

document.addEventListener('DOMContentLoaded', function() {
    toggleCompanyName();
    document.getElementById('id_customer_type').addEventListener('change', toggleCompanyName);
});
</script>
{% endblock %}