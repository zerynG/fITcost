{% extends 'base_form.html' %}

{% block title %}{% if service %}Редактировать услугу{% else %}Создать услугу{% endif %}{% endblock %}

{% block form_title %}{% if service %}Редактирование услуги{% else %}Создание услуги{% endif %}{% endblock %}

{% block form_fields %}
    {{ form.project }}
    
    <div class="mb-3">
        <label for="{{ form.name.id_for_label }}" class="form-label">{{ form.name.label }}</label>
        {{ form.name }}
        {% if form.name.errors %}
            <div class="invalid-feedback d-block">{{ form.name.errors }}</div>
        {% endif %}
    </div>
    
    <div class="row mb-3">
        <div class="col-md-6">
            <label for="{{ form.hours.id_for_label }}" class="form-label">{{ form.hours.label }}</label>
            {{ form.hours }}
            {% if form.hours.errors %}
                <div class="invalid-feedback d-block">{{ form.hours.errors }}</div>
            {% endif %}
        </div>
        <div class="col-md-6">
            <label for="{{ form.cost.id_for_label }}" class="form-label">{{ form.cost.label }}</label>
            {{ form.cost }}
            {% if form.cost.errors %}
                <div class="invalid-feedback d-block">{{ form.cost.errors }}</div>
            {% endif %}
        </div>
    </div>
    
    <div class="row mb-3">
        <div class="col-md-6">
            <label for="{{ form.start_date.id_for_label }}" class="form-label">{{ form.start_date.label }}</label>
            {{ form.start_date }}
            {% if form.start_date.errors %}
                <div class="invalid-feedback d-block">{{ form.start_date.errors }}</div>
            {% endif %}
        </div>
        <div class="col-md-6">
            <label for="{{ form.end_date.id_for_label }}" class="form-label">{{ form.end_date.label }}</label>
            {{ form.end_date }}
            {% if form.end_date.errors %}
                <div class="invalid-feedback d-block">{{ form.end_date.errors }}</div>
            {% endif %}
        </div>
    </div>
    
    <div class="mb-3">
        <label for="{{ form.monthly_cost.id_for_label }}" class="form-label">{{ form.monthly_cost.label }}</label>
        {{ form.monthly_cost }}
        {% if form.monthly_cost.errors %}
            <div class="invalid-feedback d-block">{{ form.monthly_cost.errors }}</div>
        {% endif %}
    </div>
    
    <div class="form-check mb-3">
        {{ form.is_indefinite }}
        <label class="form-check-label" for="{{ form.is_indefinite.id_for_label }}">
            {{ form.is_indefinite.label }}
        </label>
        {% if form.is_indefinite.errors %}
            <div class="invalid-feedback d-block">{{ form.is_indefinite.errors }}</div>
        {% endif %}
    </div>
{% endblock %}

{% block cancel_url %}
    {% if project_id and workspace_id %}
        {% url 'services:service_list_project' workspace_id project_id %}
    {% else %}
        {% url 'services:service_list' %}
    {% endif %}
{% endblock %}

{% block extra_js %}
<script>
function toggleEndDate() {
    const isIndefinite = document.getElementById('id_is_indefinite').checked;
    const endDateField = document.getElementById('id_end_date');
    const endDateLabel = document.querySelector('label[for="id_end_date"]');
    
    if (isIndefinite) {
        endDateField.disabled = true;
        endDateField.value = '';
        if (endDateLabel) {
            endDateLabel.style.opacity = '0.5';
        }
    } else {
        endDateField.disabled = false;
        if (endDateLabel) {
            endDateLabel.style.opacity = '1';
        }
    }
}

document.addEventListener('DOMContentLoaded', function() {
    toggleEndDate();
    document.getElementById('id_is_indefinite').addEventListener('change', toggleEndDate);
});
</script>
{% endblock %}

