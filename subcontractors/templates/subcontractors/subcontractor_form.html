{% extends 'base_form.html' %}
{% load static %}

{% block title %}
    {% if form.instance.pk %}Редактирование {{ form.instance.name }}{% else %}Добавление субподрядчика{% endif %}
{% endblock %}

{% block form_title %}
    {% if form.instance.pk %}Редактирование субподрядчика{% else %}Добавление субподрядчика{% endif %}
{% endblock %}

{% block form_fields %}
    {{ form.project }}
    
    <div class="row mb-3">
        <div class="col-md-6">
            <label for="{{ form.name.id_for_label }}" class="form-label">{{ form.name.label }}</label>
            {{ form.name }}
            {% if form.name.errors %}
                <div class="invalid-feedback d-block">{{ form.name.errors }}</div>
            {% endif %}
        </div>
        <div class="col-md-6">
            <label class="form-label">{{ form.contractor_type.label }}</label>
            <div class="mt-2">
                {% for choice in form.contractor_type %}
                    <div class="form-check form-check-inline">
                        {{ choice.tag }}
                        <label class="form-check-label" for="{{ choice.id_for_label }}">
                            {{ choice.choice_label }}
                        </label>
                    </div>
                {% endfor %}
            </div>
            {% if form.contractor_type.errors %}
                <div class="invalid-feedback d-block">{{ form.contractor_type.errors }}</div>
            {% endif %}
        </div>
    </div>

    <div class="row mb-3">
        <div class="col-md-4">
            <label for="{{ form.inn.id_for_label }}" class="form-label">{{ form.inn.label }}</label>
            {{ form.inn }}
            {% if form.inn.errors %}
                <div class="invalid-feedback d-block">{{ form.inn.errors }}</div>
            {% endif %}
        </div>
        <div class="col-md-4">
            <label for="{{ form.kpp.id_for_label }}" class="form-label">{{ form.kpp.label }}</label>
            {{ form.kpp }}
            <small class="form-text text-muted">Указывается только для юридических лиц (необязательно)</small>
            {% if form.kpp.errors %}
                <div class="invalid-feedback d-block">{{ form.kpp.errors }}</div>
            {% endif %}
        </div>
        <div class="col-md-4">
            <label for="{{ form.ogrn.id_for_label }}" class="form-label">{{ form.ogrn.label }}</label>
            {{ form.ogrn }}
            {% if form.ogrn.errors %}
                <div class="invalid-feedback d-block">{{ form.ogrn.errors }}</div>
            {% endif %}
        </div>
    </div>

    <div class="row mb-3">
        <div class="col-md-6">
            <label for="{{ form.legal_address.id_for_label }}" class="form-label">{{ form.legal_address.label }}</label>
            {{ form.legal_address }}
            {% if form.legal_address.errors %}
                <div class="invalid-feedback d-block">{{ form.legal_address.errors }}</div>
            {% endif %}
        </div>
        <div class="col-md-6">
            <label for="{{ form.actual_address.id_for_label }}" class="form-label">{{ form.actual_address.label }}</label>
            {{ form.actual_address }}
            {% if form.actual_address.errors %}
                <div class="invalid-feedback d-block">{{ form.actual_address.errors }}</div>
            {% endif %}
        </div>
    </div>

    <div class="row mb-3">
        <div class="col-md-6">
            <label for="{{ form.phone.id_for_label }}" class="form-label">{{ form.phone.label }}</label>
            {{ form.phone }}
            {% if form.phone.errors %}
                <div class="invalid-feedback d-block">{{ form.phone.errors }}</div>
            {% endif %}
        </div>
        <div class="col-md-6">
            <label for="{{ form.email.id_for_label }}" class="form-label">{{ form.email.label }}</label>
            {{ form.email }}
            {% if form.email.errors %}
                <div class="invalid-feedback d-block">{{ form.email.errors }}</div>
            {% endif %}
        </div>
    </div>

    <div class="row mb-3">
        <div class="col-md-6">
            <label for="{{ form.director_name.id_for_label }}" class="form-label">{{ form.director_name.label }}</label>
            {{ form.director_name }}
            {% if form.director_name.errors %}
                <div class="invalid-feedback d-block">{{ form.director_name.errors }}</div>
            {% endif %}
        </div>
        <div class="col-md-6">
            <label for="{{ form.bank_name.id_for_label }}" class="form-label">{{ form.bank_name.label }}</label>
            {{ form.bank_name }}
            {% if form.bank_name.errors %}
                <div class="invalid-feedback d-block">{{ form.bank_name.errors }}</div>
            {% endif %}
        </div>
    </div>

    <div class="row mb-3">
        <div class="col-md-4">
            <label for="{{ form.bank_account.id_for_label }}" class="form-label">{{ form.bank_account.label }}</label>
            {{ form.bank_account }}
            {% if form.bank_account.errors %}
                <div class="invalid-feedback d-block">{{ form.bank_account.errors }}</div>
            {% endif %}
        </div>
        <div class="col-md-4">
            <label for="{{ form.corr_account.id_for_label }}" class="form-label">{{ form.corr_account.label }}</label>
            {{ form.corr_account }}
            {% if form.corr_account.errors %}
                <div class="invalid-feedback d-block">{{ form.corr_account.errors }}</div>
            {% endif %}
        </div>
        <div class="col-md-4">
            <label for="{{ form.bik.id_for_label }}" class="form-label">{{ form.bik.label }}</label>
            {{ form.bik }}
            {% if form.bik.errors %}
                <div class="invalid-feedback d-block">{{ form.bik.errors }}</div>
            {% endif %}
        </div>
    </div>

    <div class="form-check mb-3">
        {{ form.can_be_shared }}
        <label class="form-check-label" for="{{ form.can_be_shared.id_for_label }}">
            {{ form.can_be_shared.label }}
        </label>
        {% if form.can_be_shared.errors %}
            <div class="invalid-feedback d-block">{{ form.can_be_shared.errors }}</div>
        {% endif %}
    </div>

    <div class="form-check mb-3">
        {{ form.is_active }}
        <label class="form-check-label" for="{{ form.is_active.id_for_label }}">
            {{ form.is_active.label }}
        </label>
        {% if form.is_active.errors %}
            <div class="invalid-feedback d-block">{{ form.is_active.errors }}</div>
        {% endif %}
    </div>
{% endblock %}

{% block cancel_url %}
    {% if project_id and workspace_id %}
        {% url 'subcontractors:list_project' workspace_id project_id %}
    {% else %}
        {% url 'subcontractors:list' %}
    {% endif %}
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const contractorTypeRadios = document.querySelectorAll('input[name="contractor_type"]');
    const kppField = document.querySelector('#{{ form.kpp.id_for_label }}');
    const kppLabel = document.querySelector('label[for="{{ form.kpp.id_for_label }}"]');

    function updateKppField() {
        const selectedType = document.querySelector('input[name="contractor_type"]:checked')?.value;
        if (selectedType === 'individual') {
            kppField.disabled = true;
            kppField.value = '';
            kppLabel.classList.add('text-muted');
        } else {
            kppField.disabled = false;
            kppLabel.classList.remove('text-muted');
        }
    }

    contractorTypeRadios.forEach(radio => {
        radio.addEventListener('change', updateKppField);
    });

    updateKppField();
});
</script>
{% endblock %}
